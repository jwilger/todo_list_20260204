{
  "outputStyle": "sdlc:marvin-sdlc",
  "respectGitignore": true,
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/file-edit-auth.sh"
          }
        ]
      },
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/file-edit-auth.sh"
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/session-start.sh"
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/pre-compact.sh"
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "üî∑ DOMAIN REVIEW CHECKPOINT (MANDATORY)\n\nDetect which agent just completed and enforce domain review requirements.\n\n## Check Agent Identity\n\nExamine the conversation to determine which agent just finished. Look for:\n- Agent invocation patterns (Task tool with subagent_type)\n- Agent self-identification in output\n- File modifications patterns (test files = red, production = green)\n\n## Enforcement Rules\n\n**If sdlc:red just completed:**\n- A failing test was just written\n- Domain review is MANDATORY before proceeding\n- Next action MUST be: Launch sdlc:domain with DOMAIN_CONTEXT: AFTER_RED\n- Block if orchestrator tries to skip directly to GREEN\n\n**If sdlc:green just completed:**\n- Production code was just implemented\n- Domain review is MANDATORY before proceeding  \n- Next action MUST be: Launch sdlc:domain with DOMAIN_CONTEXT: AFTER_GREEN\n- Block if orchestrator tries to write another test without review\n\n**If sdlc:domain just completed:**\n- Domain review passed, workflow may continue\n- Allow orchestrator to proceed to next phase\n\n**If any other agent completed:**\n- Allow (domain review not required)\n\n## Response Format\n\n**After RED or GREEN (domain review required):**\n```json\n{\n  \"ok\": false,\n  \"reason\": \"Domain review is MANDATORY after {agent} phase. You must launch sdlc:domain with appropriate DOMAIN_CONTEXT before proceeding. This is NOT optional - there are NO valid reasons to skip domain review.\"\n}\n```\n\n**After DOMAIN or other agents:**\n```json\n{\"ok\": true}\n```\n\nThis enforces the TDD cycle discipline: RED ‚Üí DOMAIN ‚Üí GREEN ‚Üí DOMAIN."
          }
        ]
      },
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "ü§ñ SUBAGENT COMPLETED - ORCHESTRATION REMINDER\n\nAn agent just finished. Before proceeding:\n\n‚ö†Ô∏è YOU ARE AN ORCHESTRATOR, NOT AN IMPLEMENTER ‚ö†Ô∏è\n\nYou MUST NEVER use Edit or Write tools directly.\n\nNEXT STEPS PROTOCOL:\n- Need to edit test code? ‚Üí Launch sdlc:red\n- Need to edit production code? ‚Üí Launch sdlc:green\n- Need to edit type definitions? ‚Üí Launch sdlc:domain\n- Need to edit ADRs/ARCHITECTURE.md? ‚Üí Launch sdlc:adr or sdlc:design-facilitator\n- Need to edit event model docs? ‚Üí Launch sdlc:gwt, sdlc:workflow-designer, sdlc:model-checker, or sdlc:discovery\n- Need to edit config/docs/scripts? ‚Üí Launch sdlc:file-updater\n\nTDD CYCLE CHECKPOINT:\n- After RED ‚Üí Launch sdlc:domain (review test)\n- After DOMAIN (post-red) ‚Üí Launch sdlc:green (implement)\n- After GREEN ‚Üí Launch sdlc:domain (review implementation)\n- After DOMAIN (post-green) ‚Üí Next test or refactor\n\nNO EXCEPTIONS. NO \"QUICK FIXES\". NO \"JUST ONE LINE\".\n\nIf you need to make ANY file change, launch the appropriate agent with FULL CONTEXT:\n- File paths\n- Test names and error messages\n- Required gate confirmations (RED_CONTEXT, DOMAIN_CONTEXT, GREEN confirmations)\n- Current TDD phase\n\nAgents have ZERO memory of this conversation - provide complete context every time.\n\nRespond with JSON only: {\"ok\": true}"
          }
        ]
      },
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "‚ùì QUESTION DETECTION - AskUserQuestion ENFORCEMENT\n\nAnalyze the agent's final output for patterns indicating it's blocking on user input.\n\n## What to Look For\n\n**BLOCKING QUESTION PATTERNS** (require AskUserQuestion tool):\n- \"Before I proceed, I need to know...\"\n- \"I have a few questions:\"\n- Numbered/bulleted lists of questions (2+)\n- \"Should I... or should I...\"\n- \"Which approach would you prefer:\"\n- \"Would you like me to... or...?\"\n- Questions followed by waiting (no action taken)\n\n**ACCEPTABLE PATTERNS** (no tool needed):\n- Single clarifying question while continuing work\n- Rhetorical questions in explanations (\"Why does this matter?\")\n- Questions the agent answers itself\n- Questions in code comments or documentation\n\n## Check Tool Usage\n\nDid the agent use the AskUserQuestion tool in this turn?\n\n## Decision Logic\n\n**BLOCK** if ALL of these are true:\n- Output contains 2+ questions requiring user input to proceed\n- Questions use blocking language (\"before I\", \"I need to know\")\n- Agent has NOT taken action (appears to be waiting)\n- AskUserQuestion tool was NOT used\n\n**ALLOW** if ANY of these are true:\n- AskUserQuestion was used with structured options\n- Only 0-1 simple questions asked\n- Questions are informational/rhetorical, not blocking\n- Agent continued working and asked incidental questions\n\n## Response Format\n\n**To block (force tool usage):**\n```json\n{\n  \"ok\": false,\n  \"reason\": \"You asked multiple questions requiring user input but didn't use AskUserQuestion. Please reformulate using AskUserQuestion tool with structured options for: [list specific questions]\"\n}\n```\n\n**To allow:**\n```json\n{\"ok\": true}\n```\n\nBe specific in the reason - quote the actual questions that need reformulation."
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "SESSION ENDING - FINAL CHECKS\n\nBefore this session ends, complete these checks:\n\n1. **UNSAVED MEMORIES** - Review conversation for discoveries not yet stored in memento:\n   - Debugging insights and solutions found\n   - Project-specific patterns or conventions learned\n   - Tool behaviors or workarounds discovered\n   - User preferences observed\n   Save any unsaved discoveries using mcp__memento__create_entities.\n\n2. **UNCOMMITTED WORK** - Check git status for:\n   - Staged but uncommitted changes\n   - Unstaged modifications\n   - Untracked files that should be committed\n   If uncommitted work exists, inform the user before ending.\n\n3. **IN-PROGRESS TASKS** - Check if any todos are marked in_progress:\n   - Summarize incomplete work for the user\n   - Note any blockers or next steps\n\nAfter completing all checks (or confirming nothing needs attention), respond with: {\"ok\": true}"
          }
        ]
      }
    ]
  }
}
